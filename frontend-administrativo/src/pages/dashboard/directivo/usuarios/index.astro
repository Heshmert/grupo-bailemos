---
import DashboardLayout from '../../../../layouts/DashboardLayout.astro';

// 1. CONFIGURACIÓN DE API (Descomentar cuando conectes con CakePHP)
// const API_URL = import.meta.env.PUBLIC_API_URL;
// const response = await fetch(`${API_URL}/users`, {
//   headers: { 'Authorization': `Bearer ${Astro.cookies.get('token')}` }
// });
// const users = await response.json();

// 2. DATOS DE PRUEBA (Eliminar cuando el fetch de arriba esté activo)
const users = [
  { id: 1, name1: 'Roberto', lastname1: 'Gomez', dni: 10223344, email: 'roberto@mail.com', role: 2, status: true },
  { id: 2, name1: 'Ana', lastname1: 'Martinez', dni: 20556677, email: 'ana@mail.com', role: 1, status: true },
  { id: 3, name1: 'Carlos', lastname1: 'Duarte', dni: 15889900, email: 'carlos@mail.com', role: 2, status: false }
];
---

<DashboardLayout title="Usuarios">
  <div class="header-section">
    <h1>Gestión de Usuarios</h1>
    <a href="/dashboard/directivo/usuarios/nuevo" class="add-btn">Registrar Usuario</a>
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>DNI</th>
          <th>Email</th>
          <th>Rol (ID)</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {users.map((u) => (
          <tr>
            <td>{u.name1}</td>
            <td>{u.lastname1}</td>
            <td>{u.dni}</td>
            <td>{u.email}</td>
            <td><span class="role-badge">{u.role}</span></td>
            <td>
              <span class={u.status ? 'active' : 'inactive'}>
                {u.status ? 'Activo' : 'Inactivo'}
              </span>
            </td>
            <td>
              <a href={`/dashboard/directivo/usuarios/${u.id}`} class="edit-link">Configurar</a>
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <script>
    import { checkAccess } from '../../../../utils/roleGuard.js';
    checkAccess(['1']);
  </script>
</DashboardLayout>

<style>
  .header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .add-btn {
    background: #0284c7;
    color: white;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    font-size: 0.9rem;
  }

  .table-wrapper {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }

  th {
    background: #f1f5f9;
    padding: 1rem;
    text-align: left;
    color: #475569;
    border-bottom: 2px solid #e2e8f0;
  }

  td {
    padding: 1rem;
    border-bottom: 1px solid #f1f5f9;
  }

  .role-badge {
    background: #e2e8f0;
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: bold;
  }

  .active { color: #16a34a; font-weight: bold; }
  .inactive { color: #dc2626; font-weight: bold; }

  .edit-link {
    color: #0284c7;
    text-decoration: none;
    font-weight: 500;
  }

  .edit-link:hover { text-decoration: underline; }

  @media (max-width: 768px) {
    .table-wrapper { overflow-x: auto; }
    h1 { font-size: 1.2rem; }
  }
</style>